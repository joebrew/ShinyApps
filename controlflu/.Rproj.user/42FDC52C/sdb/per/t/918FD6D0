{
    "contents" : "###################\n# READ IN ALL YEARS IMM DATA\n###################\nmyLink1314 <- \"https://docs.google.com/spreadsheets/d/1NCUziq1nP4Zv6cMXgjDN6keLmeL7u0sTG1kKk50Odj8/export?gid=0&format=csv\"\nmyLink1213 <- \"https://docs.google.com/spreadsheets/d/1Mvn6rcB9bsjIXAjiIi3dXiBKFoTsbqUFZYt0oryLNoY/export?gid=0&format=csv\"\nmyLink1112 <- \"https://docs.google.com/spreadsheets/d/1JZ6pc6j49CvovacSATrZyPhNF6N1VkDnpAZtb0QqQOs/export?gid=0&format=csv\"\nmyLink1011 <- \"https://docs.google.com/spreadsheets/d/13yJaiqHZl6tFvFsbVF5pPeDwTwDzF5NSNXxXW0-EQcU/export?gid=0&format=csv\"\nmyLink0910 <- \"https://docs.google.com/spreadsheets/d/1oviNdSupcXMBtAWnENkFMjpDunvbKcov1GhGGc_ORig/export?gid=0&format=csv\"\nmyLink0607 <- \"https://docs.google.com/spreadsheets/d/1htzrskPUajsZ3xdvzrQocJ0fNzE4bNVk4HpTqnB910I/export?gid=0&format=csv\"\n\nlibrary(RCurl)\nlibrary(RColorBrewer)\n\noptions(RCurlOptions = list(cainfo = system.file(\"CurlSSL\", \"cacert.pem\", package = \"RCurl\")))\n\n#1314\nmyCsv <- getURL(myLink1314)\nir13 <- read.csv(textConnection(myCsv), skip=1)\n\n\n#1213\nmyCsv <- getURL(myLink1213)\nir12 <- read.csv(textConnection(myCsv), skip=0)\n\n#1112\nmyCsv <- getURL(myLink1112)\nir11 <- read.csv(textConnection(myCsv), skip=0)\n\n#1011\nmyCsv <- getURL(myLink1011)\nir10 <- read.csv(textConnection(myCsv), skip=0)\n\n#0910\nmyCsv <- getURL(myLink0910)\nir09 <- read.csv(textConnection(myCsv), skip=0)\n\n#0607\nmyCsv <- getURL(myLink0607)\nir06 <- read.csv(textConnection(myCsv), skip=0)\n\n###################\n# READ IN LINKAGE DOCUMENT\n# (this doc contains id, school name, type, pubPriv)\n###################\nlinkage <- \"https://docs.google.com/spreadsheets/d/1sDxHwtNCWSIUVCzb01vu7rmLMXq88diGIbt7PH4Ntrk/export?gid=0&format=csv\"\nmyCsv <- getURL(linkage)\nlink <- read.csv(textConnection(myCsv), skip=0)\n\n###################\n# ADD YEAR COLUMN TO EACH DF\n###################\nir06$year <- 2006\nir09$year <- 2009\nir10$year <- 2010\nir11$year <- 2011\nir12$year <- 2012\nir13$year <- 2013\n\n###################\n# GET FREE/REDUCED LUNCH FOR 2013\n###################\nfrLunch <- ir13[,c(\"id\", \"frLunch13\", \"vfc\", \"priv\", \"doses\")]\nfrLunch$p.vfc <- 100 * frLunch$vfc / frLunch$doses\nfrLunch <- frLunch[, c(\"id\", \"p.vfc\", \"frLunch13\")]\n###################\n# GET RID OF UNECESSARY COLUMNS FROM IR13\n###################\n\nir13 <- ir13[,c(\"id\", \"school\", \"doses\", \"totMem\", \"immRate\", \"year\")]\n\n\n\n###################\n# BIND ALL IR DATA\n###################\nir <- rbind(ir06,\n            ir09,\n            ir10,\n            ir11,\n            ir12,\n            ir13)\n\n##################\n# REMOVE OTHER JUNK\n##################\nrm(ir06, ir09, ir10, ir11, ir12, ir13,\n   linkage, myCsv, myLink0607, myLink0910, myLink1011,\n   myLink1112, myLink1213, myLink1314)\n\n###################\n# CLEAN ir$immRate\n###################\nir$immRate[which(ir$year >= 2010)] <- \n  ir$doses[which(ir$year >= 2010)] / \n  ir$totMem[which(ir$year >= 2010)]\n\nir$immRate <- as.numeric(ir$immRate)\n\n###################\n# EXTRAPOLATE TOTMEM TO 2006-2009\n###################\nfor (i in unique(sort(ir$id[which(is.na(ir$totMem))]))){\n  ir$totMem[which(ir$id == i &\n                    is.na(ir$totMem))] <-\n    ir$totMem[which(ir$id == i &\n                      is.na(ir$totMem) == FALSE)][1]\n}\n\n###################\n# INTERPOLATE DOSES FOR 2006-2009\n###################\nir$doses[which(ir$year <=2009)] <-\n  ir$totMem[which(ir$year <=2009)]*\n  ir$immRate[which(ir$year <=2009)]  \n\n###################\n# ADD SCHOOL TYPE TO ir\n###################\nir$type <- NA\nfor (i in link$id){\n  ir$type[which(ir$id == i)] <-\n    as.character(link$type[which(link$id == i)])\n}\n\n###################\n# ADD GRADE RANGE TO ir\n###################\nir$gradeRange <- NA\nfor (i in link$id){\n  ir$gradeRange[which(ir$id == i)] <-\n    as.character(link$gradeRange[which(link$id == i)])\n}\n\n###################\n# ADD FUNDING TYPE TO ir (pubPriv)\n###################\nir$pubPriv <- NA\nfor (i in link$id){\n  ir$pubPriv[which(ir$id == i)] <-\n    as.character(link$pubPriv[which(link$id == i)])\n}\n\n###################\n# ORDER LINK DOCUMENT\n###################\nlink <- link[order(link$school),]\n\n##################################################################################################################\n\n##########################\n# READ IN SIMPASYM FUNCTION\n# http://aghaynes.wordpress.com/2014/04/09/calculating-confidence-intervals-for-proportions/\n##########################\nsimpasym <- function(n, p, z=1.96, cc=TRUE){\n  out <- list()\n  if(cc){\n    out$lb <- p - z*sqrt((p*(1-p))/n) - 0.5/n\n    out$ub <- p + z*sqrt((p*(1-p))/n) + 0.5/n\n  } else {\n    out$lb <- p - z*sqrt((p*(1-p))/n)\n    out$ub <- p + z*sqrt((p*(1-p))/n)\n  }\n  out\n}\n\n#######TEST SIGNIFICANCE BY YEAR\nbla <- simpasym(n=sum(ir$doses[which(ir$year == 2013 &\n                                       ir$pubPriv == \"pub\")]),\n                p=sum(ir$doses[which(ir$year == 2013 &\n                                       ir$pubPriv == \"pub\")])/\n                  sum(ir$totMem[which(ir$year == 2013 &\n                                        ir$pubPriv == \"pub\")]),\n                z=1.96,\n                cc=TRUE)\n\n\n###################\n# CREATE YEAR SPECIFIC DATAFRAME\n###################\nts <- as.data.frame(unique(sort(ir$year)))\ncolnames(ts) <- \"year\"\n\n###################\n# NUMBER OF DOSES ADMINISTERED PER YEAR\n###################\nts$doses <- NA\nfor(i in ts$year){\n  ts$doses[which(ts$year == i)] <-\n    sum(ir$doses[which(ir$year == i)], na.rm=TRUE)\n}\n\n###################\n# NUMBER OF TOTAL STUDENTS PER YEAR\n###################\nts$totMem <- NA\nfor(i in ts$year){\n  ts$totMem[which(ts$year == i)] <-\n    sum(ir$totMem[which(ir$year == i)], na.rm=TRUE)\n}\n\n###################\n# IMMRATE\n###################\nts$immRate <- ts$doses/ts$totMem\n\n##################################################################################################################\n###################\n# PRIVATE DOSES\n###################\nts$dosesPriv <- NA\nfor (i in ts$year){\n  ts$dosesPriv[which(ts$year == i)] <- \n    sum(ir$doses[which(ir$year == i & \n                         ir$pubPriv == \"priv\")],\n        na.rm=TRUE)\n}\n\n###################\n# PRIVATE TOTAL STUDENTS PER YEAR\n###################\nts$totMemPriv <- NA\nfor (i in ts$year){\n  ts$totMemPriv[which(ts$year == i)] <- \n    sum(ir$totMem[which(ir$year == i & \n                         ir$pubPriv == \"priv\")],\n        na.rm=TRUE)\n}\n\n###################\n# IMMRATE PRIVATE\n###################\nts$immRatePriv <- ts$dosesPriv/ts$totMemPriv\n\n###################\n# ADD UPPER AND LOWERBOUND TO TS FOR PRIV/PUB IMMRATES\n###################\n#PRIV LOWER\nts$immRatePrivLower <- NA\nfor (i in ts$year){\n  \n  temp <- simpasym(n=sum(ir$doses[which(ir$year == i &\n                                          ir$pubPriv == \"priv\")]),\n                   p=sum(ir$doses[which(ir$year == i &\n                                          ir$pubPriv == \"priv\")])/\n                     sum(ir$totMem[which(ir$year == i &\n                                           ir$pubPriv == \"priv\")]),\n                   z=1.96,\n                   cc=TRUE)\n  \n  ts$immRatePrivLower[which(ts$year == i)] <- temp$lb\n  \n}\n\n#PRIV UPPER\nts$immRatePrivUpper <- NA\nfor (i in ts$year){\n  \n  temp <- simpasym(n=sum(ir$doses[which(ir$year == i &\n                                          ir$pubPriv == \"priv\")]),\n                   p=sum(ir$doses[which(ir$year == i &\n                                          ir$pubPriv == \"priv\")])/\n                     sum(ir$totMem[which(ir$year == i &\n                                           ir$pubPriv == \"priv\")]),\n                   z=1.96,\n                   cc=TRUE)\n  \n  ts$immRatePrivUpper[which(ts$year == i)] <- temp$ub\n  \n}\nts$immRatePrivCI <- paste0(round(100*ts$immRatePrivLower, digits=2), \"-\", round(100*ts$immRatePrivUpper, digits=2))\n\n\n\n\n#########################################################\n###################\n# PUBLIC DOSES\n###################\nts$dosesPub <- NA\nfor (i in ts$year){\n  ts$dosesPub[which(ts$year == i)] <- \n    sum(ir$doses[which(ir$year == i & \n                         ir$pubPriv == \"pub\")],\n        na.rm=TRUE)\n}\n\n###################\n# PUBLIC TOTAL STUDENTS PER YEAR\n###################\nts$totMemPub <- NA\nfor (i in ts$year){\n  ts$totMemPub[which(ts$year == i)] <- \n    sum(ir$totMem[which(ir$year == i & \n                          ir$pubPriv == \"pub\")],\n        na.rm=TRUE)\n}\n\n\n###################\n# IMMRATE PUBLIC\n###################\nts$immRatePub <- ts$dosesPub/ts$totMemPub\n\n#PUB LOWER\nts$immRatePubLower <- NA\nfor (i in ts$year){\n  \n  temp <- simpasym(n=sum(ir$doses[which(ir$year == i &\n                                          ir$pubPriv == \"pub\")]),\n                   p=sum(ir$doses[which(ir$year == i &\n                                          ir$pubPriv == \"pub\")])/\n                     sum(ir$totMem[which(ir$year == i &\n                                           ir$pubPriv == \"pub\")]),\n                   z=1.96,\n                   cc=TRUE)\n  \n  ts$immRatePubLower[which(ts$year == i)] <- temp$lb\n  \n}\n\n\n#PUB Upper\nts$immRatePubUpper <- NA\nfor (i in ts$year){\n  \n  temp <- simpasym(n=sum(ir$doses[which(ir$year == i &\n                                          ir$pubPriv == \"pub\")]),\n                   p=sum(ir$doses[which(ir$year == i &\n                                          ir$pubPriv == \"pub\")])/\n                     sum(ir$totMem[which(ir$year == i &\n                                           ir$pubPriv == \"pub\")]),\n                   z=1.96,\n                   cc=TRUE)\n  \n  ts$immRatePubUpper[which(ts$year == i)] <- temp$ub\n  \n}\nts$immRatePubCI <- paste0(round(100*ts$immRatePubLower, digits=2), \"-\", round(100*ts$immRatePubUpper, digits=2))\n\n#########################################################\n\n###################\n# ADD A COLUMN FOR EACH SCHOOL\n###################\nfor (i in unique(sort(ir$id))){\n  ts[,paste0(\"school\",i)] <- NA\n}\nfor (i in ts$year){\n  for (j in unique(sort(ir$id))){\n    ts[which(ts$year == i), paste0(\"school\",j)] <-\n      ir$immRate[which(ir$year == i &\n                         ir$id == j)][1]\n  }\n}\n\n\n###################\n# CREATE PUB PRIV DATA FRAMES SIMPLE TS FOR WRITE-UP\n###################\n\n#PRIV\ntsPriv <- ts[,c(\"year\", \n             \"dosesPriv\", \n             \"totMemPriv\", \n             \"immRatePriv\",\n             \"immRatePrivCI\")]\n\ntsPriv$immRatePriv <- round(tsPriv$immRatePriv*100, digits=2)\ntsPriv$dosesPriv <- as.character(tsPriv$dosesPriv)\ntsPriv$year <- as.character(tsPriv$year)\n\ntsPriv <- tsPriv[which(tsPriv$year >=2010),]\n\ntsPriv2 <- tsPriv\ncolnames(tsPriv2) <- c(\"Year\",\n                       \"Doses\",\n                       \"Students\",\n                       \"I.R.\",\n                       \"95% C.I.\")\n\n\n#Pub\ntsPub <- ts[,c(\"year\", \n                \"dosesPub\", \n                \"totMemPub\", \n                \"immRatePub\",\n                \"immRatePubCI\")]\n\ntsPub$immRatePub <- round(tsPub$immRatePub*100, digits=2)\ntsPub$dosesPub <- as.character(tsPub$dosesPub)\ntsPub$year <- as.character(tsPub$year)\n\ntsPub2 <- tsPub\ncolnames(tsPub2) <- c(\"Year\",\n                       \"Doses\",\n                       \"Students\",\n                       \"I.R.\",\n                       \"95% C.I.\")\n\n###################\n# PLOT ALL SCHOOLS\n###################\n\n#LAYOUT\nplot(x=ts$year, \n     y=ts$immRatePriv, \n     type=\"n\",\n     col=\"red\",\n     ylim=c(0,0.8),\n     xlim=c(2006, 2013),\n     xaxt=\"n\",\n     xlab=\"Year\",\n     yaxt=\"n\",\n     ylab=\"Immunization rate\")\n#AXIS\naxis(side=1, at=ts$year,\n     labels=paste0(ts$year,\"-\\n\",ts$year+1, \" \"),\n     cex.axis=1,\n     tick=FALSE,\n     line=1)\naxis(side=2, at=seq(0,1,0.2),\n     labels=paste0(seq(0,1,0.2)*100,\n                   \"%\"), las=1)\n#GRIDLINES\nabline(h=seq(0,1,0.1),\n       col=adjustcolor(\"black\", alpha.f=0.2))\nabline(v=2006:2013,\n       col=adjustcolor(\"black\", alpha.f=0.2))\n\n###################\n# ADD PUBLIC SCHOOLS\n###################\nfor (i in link$id[which(link$pubPriv == \"pub\")]){\n  lines(ts$year,\n        ts[,paste0(\"school\",i)],\n        col=adjustcolor(\"darkblue\", alpha.f=0.1),\n        lwd=.2*ir$totMem[which(ir$id == i)]^(1/2)[1])\n}\n\n###################\n# ADD MEAN PUBLIC\n###################\nlines(x=ts$year, \n      y=ts$immRatePub,\n      col=adjustcolor(\"darkblue\", alpha.f=0.6),\n      lwd=1)\npoints(x=ts$year,\n       y=ts$immRatePub,\n       pch=16,\n       col=adjustcolor(\"darkblue\", alpha.f=0.6),\n       cex=1)\n\n###################\n# ADD PRIVATE SCHOOLS\n###################\nfor (i in link$id[which(link$pubPriv == \"priv\")]){\n  lines(ts$year,\n        ts[,paste0(\"school\",i)],\n        col=adjustcolor(\"darkred\", alpha.f=0.1),\n        lwd=.2*ir$totMem[which(ir$id == i)]^(1/2)[1])\n}\n\n###################\n# ADD MEAN PRIVATE\n###################\nlines(x=ts$year, \n      y=ts$immRatePriv,\n      col=adjustcolor(\"darkred\", alpha.f=0.6),\n      lwd=1)\n\npoints(x=ts$year,\n       y=ts$immRatePriv,\n       pch=17,\n       col=adjustcolor(\"darkred\", alpha.f=0.6),\n       cex=1.5)\n\n###################\n# PLOT ALL SCHOOLS\n###################\n\npar(mar=c(4,3,2,1))\npar(oma=c(0,0,0,0))\npar(mfrow=c(6,4))\n\n#PUBLIC\nfor (i in link$id[which(link$pubPriv == \"pub\")]){\n  plot(x=ts$year, \n       y=ts[,paste0(\"school\", i)],\n       col=adjustcolor(\"darkblue\", alpha.f=0.6),\n       type=\"l\",\n       ylim=c(0,1),\n       xlim=c(2006, 2013),\n       xaxt=\"n\",\n       xlab=NA,\n       yaxt=\"n\",\n       ylab=\"Immunization rate\",\n       lwd=2,\n       main=link$school[which(link$id == i)],\n       cex.main=1)\n  \n  #XLAB\n  #mtext(\"Year\", side=1, line=1,\n   #     cex=0.6)\n  \n  # POINTS\n  points(x=ts$year, \n         y=ts[,paste0(\"school\", i)],\n         col=adjustcolor(\"darkblue\", alpha.f=0.6),\n         pch=16)\n  \n  #AXIS\n  axis(side=1, at=ts$year,\n       labels=gsub(\"20\", \"\",paste0(ts$year,\"-\\n\",ts$year+1, \" \")),\n       cex.axis=0.8,\n       tick=FALSE,\n       line=0)\n  axis(side=2, at=seq(0,1,0.2),\n       labels=paste0(seq(0,1,0.2)*100,\n                     \"%\"), las=1,\n       cex.axis=0.8)\n  #GRIDLINES\n  abline(h=seq(0,1,0.1),\n         col=adjustcolor(\"black\", alpha.f=0.2))\n  abline(v=2006:2013,\n         col=adjustcolor(\"black\", alpha.f=0.2))\n  \n  text(x=ts$year,\n       y=ts[,paste0(\"school\", i)]+0.08,\n       labels=paste0(round(100*ts[,paste0(\"school\", i)], digits=1),\n                     \"%\"),\n       col=adjustcolor(\"black\", alpha.f=0.6),\n       cex=0.5)\n}\n\n\n\npar(mar=c(4,3,2,1))\npar(oma=c(0,0,0,0))\npar(mfrow=c(6,4))\n#PRIVATE\nfor (i in link$id[which(link$pubPriv == \"priv\")]){\n  plot(x=ts$year, \n       y=ts[,paste0(\"school\", i)],\n       col=adjustcolor(\"darkred\", alpha.f=0.6),\n       type=\"l\",\n       ylim=c(0,1),\n       xlim=c(2006, 2013),\n       xaxt=\"n\",\n       xlab=NA,\n       yaxt=\"n\",\n       ylab=\"Immunization rate\",\n       lwd=2,\n       main=link$school[which(link$id == i)],\n       cex.main=1)\n  \n  #XLAB\n  #mtext(\"Year\", side=1, line=1,\n  #     cex=0.6)\n  \n  # POINTS\n  points(x=ts$year, \n         y=ts[,paste0(\"school\", i)],\n         col=adjustcolor(\"darkred\", alpha.f=0.6),\n         pch=16)\n  #AXIS\n  axis(side=1, at=ts$year,\n       labels=gsub(\"20\", \"\",paste0(ts$year,\"-\\n\",ts$year+1, \" \")),\n       cex.axis=0.8,\n       tick=FALSE,\n       line=0)\n  axis(side=2, at=seq(0,1,0.2),\n       labels=paste0(seq(0,1,0.2)*100,\n                     \"%\"), las=1,\n       cex.axis=0.8)\n  #GRIDLINES\n  abline(h=seq(0,1,0.1),\n         col=adjustcolor(\"black\", alpha.f=0.2))\n  abline(v=2006:2013,\n         col=adjustcolor(\"black\", alpha.f=0.2))\n  \n  text(x=ts$year,\n       y=ts[,paste0(\"school\", i)]+0.08,\n       labels=paste0(round(100*ts[,paste0(\"school\", i)], digits=1),\n                     \"%\"),\n       col=adjustcolor(\"black\", alpha.f=0.6),\n       cex=0.5)\n}\n\n\n\n###################\n# \n###################\n\n\n\n\n###################\n# \n###################\n\n\n\n\n###################\n# \n###################\n\n\n\n\n###################\n# \n###################\n\n\n\n\n###################\n# \n###################\n\n###################\n# PLOT\n###################\n\npar(mfrow=c(1,1))\n\n#PRIVATE\nplot(x=ts$year, \n     y=ts$immRatePriv, \n     type=\"l\",\n     col=\"red\",\n     ylim=c(.3,.6),\n     xlim=c(2010, 2013),\n     xaxt=\"n\",\n     xlab=\"Year\",\n     yaxt=\"n\",\n     ylab=\"Immunization rate\")\n\npoints(x=ts$year,\n       y=ts$immRatePriv,\n       pch=17,\n       col=\"red\")\n\n#PUBLIC\nlines(x=ts$year, \n      y=ts$immRatePub,\n      col=\"blue\")\n\npoints(x=ts$year,\n       y=ts$immRatePub,\n       pch=16,\n       col=\"blue\")\n\n#AXIS\naxis(side=1, at=ts$year,\n     labels=paste0(ts$year,\"-\\n\",ts$year+1),\n     cex.axis=1,\n     tick=FALSE)\naxis(side=2, at=seq(0,1,0.1),\n     labels=paste0(seq(0,1,0.1)*100,\n                   \"%\"))\n\n#LEGEND\nlegend(x=\"topleft\",\n       col=c(\"blue\", \"red\"),\n       pch=c(16,17),\n       lty=1,\n       legend=c(\"Public\", \"Private\"),\n       bty=\"n\")\n\n#GRIDLINES\nabline(h=seq(0,1,0.05),\n       col=adjustcolor(\"black\", alpha.f=0.2))\n\nabline(v=c(2010,2011,2012,2013),\n       col=adjustcolor(\"black\", alpha.f=0.2))\n\n\n\n#TITLE\ntitle(main=\"Weighted mean immunization rate\",\n      outer=TRUE, line=-1)\n\n\n#### BARPLOT OF IMM AND CONFINT\n\nlibrary(Hmisc)\n\n#PUBLIC\npar(mfrow=c(1,1))\nmybp <- barplot(ts$immRatePub*100,\n                ylim=c(0,50),\n                col=adjustcolor(\"darkblue\", alpha.f=0.4),\n                border=NA)\n\nabline(h=seq(0,100,10),\n       col=adjustcolor(\"black\", alpha.f=0.2))\n\nerrbar(x=mybp[,1]-0.1, \n        y=ts$immRatePub*100,\n        yplus=ts$immRatePubUpper*100,\n        yminus = ts$immRatePubLower*100,\n        add=TRUE,\n        type=\"n\",\n       errbar.col=adjustcolor(\"darkblue\", alpha.f=0.6))\n\n#PRIVATE\nmybp <- barplot(ts$immRatePriv*100,\n                ylim=c(0,50),\n                col=adjustcolor(\"darkred\", alpha.f=0.4),\n                border=NA,\n                add=TRUE)\n\nerrbar(x=mybp[,1]+0.1, \n       y=ts$immRatePriv*100,\n       yplus=ts$immRatePrivUpper*100,\n       yminus = ts$immRatePrivLower*100,\n       add=TRUE,\n       type=\"n\",\n       errbar.col=adjustcolor(\"darkred\", alpha.f=0.6))\n\n#AXIS\naxis(side=1, at=mybp[,1],labels=ts$year,\n     tick=FALSE)\n\n#LEGEND\nlegend(x=\"topleft\",\n       fill=adjustcolor(c(\"darkblue\", \"darkred\"),alpha.f=0.6),\n       legend=c(\"Public\", \"Private\"),\n       bty=\"n\",\n       border=FALSE)\n\n\n#T.TEST\nlibrary(weights)\nwtd.t.test(x=ir$immRate[which(ir$pubPriv == \"pub\" &\n                                ir$year >=2010)],\n           y=ir$immRate[which(ir$pubPriv == \"priv\")],\n           weight=ir$totMem[which(ir$pubPriv == \"pub\" &\n                                    ir$year >=2010)],\n           weighty=ir$totMem[which(ir$pubPriv == \"priv\")],\n           samedata=FALSE)\n\n###################\n# COMPARE JUST ELEMENTARY SCHOOLS (per Parker's request on 20 May 2014)\n###################\n#T.TEST\n\nwtd.t.test(x=ir$immRate[which(ir$pubPriv == \"pub\" &\n                                ir$year >=2010 &\n                                ir$type == \"elem\")],\n           y=ir$immRate[which(ir$pubPriv == \"priv\" &\n                                ir$type == \"elem\")],\n           weight=ir$totMem[which(ir$pubPriv == \"pub\" &\n                                    ir$year >=2010 &\n                                    ir$type == \"elem\")],\n           weighty=ir$totMem[which(ir$pubPriv == \"priv\" &\n                                     ir$type == \"elem\")],\n           samedata=FALSE)\n\n\n#SAVE IMAGE\nsave.image(\"E:/fdoh/private/fluMist/immRatesHistorical/pubVsPriv/immRates.RData\")\n\n######################\n# FOR PAUL, DOES REVIEW AND PURSUE MAKE A DIFFERENCE?\n######################\n\n\n###############\n# MERGE FR/RE LUNCH INFO WITH IR\n###############\nlibrary(plyr)\n\nx <- join(x = ir,\n          y = frLunch,\n          by = \"id\",\n          type = \"left\")\nir <- x\nrm(x)\n\n###############\n# IN ir, STANDARDIZE SCHOOL NAMES\n###############\nir$school <- NULL\nlink.small <- link[,c(\"id\", \"school\")]\n\nir <- join(x = ir,\n           y = link.small,\n           by = \"id\", \n           type = \"left\")\n\nir$school <- toupper(ir$school)\nir$frLunch13 <- NULL\n\n###############\n# WRITE CSV FOR SHINY APP\n###############\nwrite.csv(ir, \"e:/fdoh/private/fluMist/ir.csv\")\n\n\n###############\n# EXCLUDE PRESCHOOLS\n###############\nir <- ir[which(ir$type != \"prek\"),]\n\n###############\n# CONVERT IMM RATE TO A 0-100 SCALE\n###############\nir$immRate <- ir$immRate * 100\n\n##############\n# REGRESSION \n##############\n\nir13 <- ir[which(ir$year == 2013),]\n\nfit <- lm(immRate ~ p.vfc + pubPriv + type, data = ir)\nfit13 <- lm(immRate ~ p.vfc + pubPriv + type, data = ir13)\n\nsummary(fit)\n\n\n##############\n# PLOT\n##############\n\n# ASSIGN COLOR BASED ON PUBPRIV\nir$col <- ifelse(ir$pubPriv == \"pub\", \"blue\", \"red\")\nir$col <- adjustcolor(ir$col, alpha.f=0.3)\n\n# SEPARETE INTO PUB AND PRIV\npub <- ir[which(ir$pubPriv == \"pub\"),]\npriv <- ir[which(ir$pubPriv == \"priv\"),]\n\nplot(ir$p.vfc, ir$immRate,\n     col=ir$col,\n     pch=16,)\n\nabline(lm(pub$immRate ~ pub$p.vfc), col=pub$col)\nabline(lm(priv$immRate ~ priv$p.vfc), col=priv$col)\n\n##############\n# SAVE \n##############\nrm(bla, i, j, myCsv, myLink1314, temp,\n   frLunch, link, mybp, ts, tsPriv, tsPriv2, tsPub, tsPub2, x)\nsave.image(\"E:/fdoh/private/fluMist/immRatesHistorical/pubVsPriv/immRates.RData\")\n",
    "created" : 1406691621059.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "781563531",
    "id" : "918FD6D0",
    "lastKnownWriteTime" : 1406692426,
    "path" : "E:/fdoh/private/fluMist/immRatesHistorical/immRates.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}