x <- for (i in 2006:2013){paste(rep(i, length(unique(sort(ts$school)))))}
for (i in 2006:2013){paste(rep(i, length(unique(sort(ts$school)))))}
for (i in 2006:2013){paste(rep(i, length(unique(sort(ts$school)))))}
for (i in 2006:2013){print(rep(i, length(unique(sort(ts$school)))))}
ts$year <- NA
for (i in unique(sort(ts$school))){
for (j in 1:length(2006:2013)){
ts$year[which(ts$school == i)] <-
2006:2013[j]
}
}
for (i in 2006:2013){print(rep(i, length(unique(sort(ts$school)))))}
head(cl)
head(cf)
head(ir)
head(cl)
#Prepare colors, load packages, set wd ###########################
######################################################################################
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#
######################################################################################
myCols <- adjustcolor(c("darkgreen", "blue", "red", "darkorange", "purple"), alpha.f=0.6)
myCols2 <- myCols[1:3]
library(gdata)
library(stats)
library(SemiPar)
######################################################################################
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#
######################################################################################
setwd("E:/fdoh/private/fluMist/cfrr")
imm0607 <- read.xls("imm0607.xlsx")
imm0607$vacNum <- as.numeric(as.character(imm0607$VAX))*as.numeric(as.character(imm0607$POP))
imm0607 <- imm0607[which(imm0607$type != "prek" &
imm0607$type != "other"),]
imm0607$year <- 2006
z.elem0607 <- ifelse(is.na(sum(imm0607$vacNum[which(imm0607$type=="elem")]) /
sum(imm0607$POP[which(imm0607$type=="elem")])),
0,
sum(imm0607$vacNum[which(imm0607$type=="elem")]) /
sum(imm0607$POP[which(imm0607$type=="elem")]))
z.mid0607 <- sum(imm0607$vacNum[which(imm0607$type=="mid")], na.rm=TRUE) /
sum(imm0607$POP[which(imm0607$type=="mid")], na.rm=TRUE)
z.high0607 <- 0
z.tot0607 <- sum(imm0607$vacNum, na.rm=TRUE) /sum(imm0607$POP, na.rm=TRUE)
######################################################################################
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#
######################################################################################
#0910
imm0910 <- read.xls("imm0910.xlsx")
imm0910$vacNum <- as.numeric(as.character(imm0910$VAX))*as.numeric(as.character(imm0910$POP))
imm0910 <- imm0910[which(imm0910$type != "prek" &
imm0910$type != "other"),]
z.elem0910 <- sum(imm0910$vacNum[which(imm0910$type=="elem")]) /sum(imm0910$POP[which(imm0910$type=="elem")])
z.mid0910 <- sum(imm0910$vacNum[which(imm0910$type=="mid")]) /sum(imm0910$POP[which(imm0910$type=="mid")])
z.high0910 <- 0
z.tot0910 <- sum(imm0910$vacNum) /sum(imm0910$POP)
imm0910$year <- 2009
######################################################################################
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#
######################################################################################
#1011
imm1011 <- read.xls("imm1011.xlsx")
imm1011 <- imm1011[which(imm1011$type != "prek" &
imm1011$type != "other"),]
z.elem1011 <- sum(as.numeric(as.character(imm1011$dosesGiven[which(imm1011$type == "elem")])), na.rm=TRUE) /
sum(as.numeric(as.character(imm1011$POP[which(imm1011$type == "elem")])), na.rm=TRUE)
z.mid1011 <- sum(as.numeric(as.character(imm1011$dosesGiven[which(imm1011$type == "mid")])), na.rm=TRUE) /
sum(as.numeric(as.character(imm1011$POP[which(imm1011$type == "mid")])), na.rm=TRUE)
z.high1011 <- sum(as.numeric(as.character(imm1011$dosesGiven[which(imm1011$type == "high")])), na.rm=TRUE) /
sum(as.numeric(as.character(imm1011$POP[which(imm1011$type == "high")])), na.rm=TRUE)
z.tot1011 <- sum(as.numeric(as.character(imm1011$dosesGive)), na.rm=TRUE) /
sum(as.numeric(as.character(imm1011$POP)), na.rm=TRUE)
imm1011$year <- 2010
######################################################################################
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#
######################################################################################
# 1112
imm1112 <- read.xls("immComplete2011.xlsx")
#Clean the Grade column
imm1112$Grade <- gsub("th|st|nd|rd", "", imm1112$Grade)
imm1112$Grade <- as.numeric(as.character(factor(ifelse(imm1112$Grade == "KG",  0,
ifelse(imm1112$Grade == "Pk",-1,
ifelse(imm1112$Grade == "PK",-1,
ifelse(imm1112$Grade == "HS",-2,
ifelse(imm1112$Grade == "6h",6,
imm1112$Grade))))))))
imm1112$type <- factor(ifelse(imm1112$Grade <0,"prek",
ifelse(imm1112$Grade >=0 & imm1112$Grade <=5,"elem",
ifelse(imm1112$Grade >=6 & imm1112$Grade <=8,  "mid",
ifelse(imm1112$Grade >=9, "high",
NA)))))
imm1112$col <- ifelse(imm1112$type == "elem", myCols[1],
ifelse(imm1112$type == "mid",  myCols[2],
ifelse(imm1112$type == "high", myCols[3],
ifelse(imm1112$type == "prek", myCols[4], myCols[5]))))
imm1112$immRate <- 100*imm1112$Received.Vaccine / imm1112$Total.Pop
imm1112$cfrr <- 100*(imm1112$Received.Vaccine + imm1112$No +
ifelse(is.na(imm1112$Refused)==TRUE,
0,
imm1112$Refused)) /  imm1112$Total.Pop
imm1112 <- imm1112[which(imm1112$type != "prek" &
imm1112$type != "other" &
imm1112$cfrr <= 100 &
imm1112$immRate <= 100),]
z.tot1112 <- sum(imm1112$Received.Vaccine) / sum(imm1112$Total.Pop)
z.elem1112 <- sum(imm1112$Received.Vaccine[which(imm1112$type == "elem")]) /
sum(imm1112$Total.Pop[which(imm1112$type == "elem")])
z.mid1112 <- sum(imm1112$Received.Vaccine[which(imm1112$type == "mid")]) /
sum(imm1112$Total.Pop[which(imm1112$type == "mid")])
z.high1112 <- sum(imm1112$Received.Vaccine[which(imm1112$type == "high")]) /
sum(imm1112$Total.Pop[which(imm1112$type == "high")])
imm1112$year <- 2011
######################################################################################
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#
######################################################################################
#1213
imm1213 <- read.xls("joe1213.xlsx")
imm1213$Grade <- as.numeric(as.character(ifelse(imm1213$Grade == "PK", "-1",
ifelse(imm1213$Grade == "KG", "0",
as.character(imm1213$Grade)))))
imm1213$type <- factor(imm1213$type)
imm1213$Total.Pop <- imm1213$Total.Pop.
imm1213$col <- ifelse(imm1213$type == "elem", myCols[1],
ifelse(imm1213$type == "mid",  myCols[2],
ifelse(imm1213$type == "high", myCols[3],
ifelse(imm1213$type == "prek", myCols[4], myCols[5]))))
imm1213$immRate <- 100*imm1213$Received.Vaccine / imm1213$Total.Pop
imm1213$cfrr <- 100*(imm1213$Received.Vaccine+ imm1213$No +
ifelse(is.na(imm1213$Refused)==TRUE,
0,
imm1213$Refused)) /  imm1213$Total.Pop
imm1213 <- imm1213[which(imm1213$type != "prek" &
imm1213$type != "other" &
imm1213$cfrr <= 100 &
imm1213$immRate <= 100),]
z.tot1213 <- sum(imm1213$Received.Vaccine) / sum(imm1213$Total.Pop)
z.elem1213 <- sum(imm1213$Received.Vaccine[which(imm1213$type == "elem")]) / sum(imm1213$Total.Pop[which(imm1213$type == "elem")])
z.mid1213 <- sum(imm1213$Received.Vaccine[which(imm1213$type == "mid")]) / sum(imm1213$Total.Pop[which(imm1213$type == "mid")])
z.high1213 <- ifelse(is.na(sum(imm1213$Received.Vaccine[which(imm1213$type == "high")]) /
sum(imm1213$Total.Pop[which(imm1213$type == "high")]))==TRUE,  0,
sum(imm1213$Received.Vaccine[which(imm1213$type == "high")]) / sum(imm1213$Total.Pop[which(imm1213$type == "high")]))
imm1213$year <- 2012
imm1213$School <- imm1213$school
######################################################################################
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#
######################################################################################
#1314
imm1314 <- read.csv("allschools1314.csv") #this was manually compiled by me from all the ind files
imm1314$col <- ifelse(imm1314$type == "elem",  myCols[1],
ifelse(imm1314$type == "mid",  myCols[2],
ifelse(imm1314$type == "high", myCols[3],
ifelse(imm1314$type == "prek",
myCols[4],  myCols[5]))))
imm1314$Total.Pop <- imm1314$Total.Pop.
imm1314$immRate <- 100*imm1314$Total.Vaccine / imm1314$Total.Pop
imm1314$cfrr <- 100*(imm1314$Total.Vaccine + imm1314$No +
ifelse(is.na(imm1314$Refused)==TRUE,
0, imm1314$Refused)) /  imm1314$Total.Pop
imm1314 <- imm1314[which(imm1314$type != "prek" &
imm1314$type != "other" &
imm1314$cfrr <= 100 &
imm1314$immRate <= 100),]
z.tot1314 <- sum(imm1314$Total.Vaccine) / sum(imm1314$Total.Pop.)
z.elem1314 <- sum(imm1314$Total.Vaccine[which(imm1314$type == "elem")]) /
sum(imm1314$Total.Pop.[which(imm1314$type == "elem")])
z.mid1314 <- sum(imm1314$Total.Vaccine[which(imm1314$type == "mid")]) /
sum(imm1314$Total.Pop.[which(imm1314$type == "mid")])
z.high1314 <- sum(imm1314$Total.Vaccine[which(imm1314$type == "high")]) /
sum(imm1314$Total.Pop.[which(imm1314$type == "high")])
imm1314$year <- 2013
######################################################################################
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#
######################################################################################
#COMBINE ALL YEARS INTO A DATAFRAME FOR A FIGURE SHOWING ONLY IMM RATES
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#
allYears <- as.data.frame(2006:2013)
colnames(allYears) <- "year"
allYears$elem <- c(z.elem0607, 0, 0, z.elem0910, z.elem1011, z.elem1112, z.elem1213, z.elem1314 )
allYears$mid <- c(z.mid0607, 0, 0, z.mid0910, z.mid1011, z.mid1112, z.mid1213, z.mid1314 )
allYears$high <- c(z.high0607, 0, 0, z.high0910, z.high1011, z.high1112, z.high1213, z.high1314 )
allYears$tot <- c(z.tot0607, 0, 0, z.tot0910, z.tot1011, z.tot1112, z.tot1213, z.tot1314 )
######################################################################################
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#
######################################################################################
###### COMBINE ALL YEARS INTO ONE COMBINED DATA FRAME
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#
imm1112temp <- imm1112[,c("type", "cfrr", "immRate", "col", "Total.Pop", "year", "Teacher", "School")]
imm1213temp <- imm1213[,c("type", "cfrr", "immRate", "col", "Total.Pop", "year", "Teacher", "School")]
imm1314temp <- imm1314[,c("type", "cfrr", "immRate", "col", "Total.Pop", "year", "Teacher", "School")]
imm <- as.data.frame(rbind(imm1112temp, imm1213temp, imm1314temp))
##################
head(imm)
View(imm0607)
View(imm1213temp)
View(imm1314)
namesimm1011
names(imm1011)
head(imm1011)
head(imm1112)
head(imm1213)
head(imm1314)
imm1112temp <- imm1112[,c("type", "cfrr", "immRate", "col", "Total.Pop", "year", "Teacher", "School", "Grade")]
imm1213temp <- imm1213[,c("type", "cfrr", "immRate", "col", "Total.Pop", "year", "Teacher", "School", "Grade")]
imm1314temp <- imm1314[,c("type", "cfrr", "immRate", "col", "Total.Pop", "year", "Teacher", "School", "Grade")]
imm <- as.data.frame(rbind(imm1112temp, imm1213temp, imm1314temp))
head(imm)
write.csv(imm, "C:/Users/BrewJR/Documents/ShinyApps/controlflu/dirty/class.csv")
setwd("C:/Users/BrewJR/Documents/ShinyApps/controlflu/dirty")
library(plyr)
ir <- read.csv("ir.csv")
# READ CFRR
cf <- read.csv("cfrr.csv")
cf$school <- as.character(gsub("^\\s+|\\s+$", "", cf$school_bad))
# READ CLASS CFRR AND IR DATA
cl <- read.csv("class.csv")
cl$school <- as.character(gsub("^\\s+|\\s+$", "", cl$School))
# FIX UP CL
library(car)
cl$school <- recode(cl$school,
"'Alachua ES' = 'Alachua';
'AQ Jones' = 'A Quinn';
'Archer Elem' = 'Archer';
'Finely' = 'Finley';
'Ft Clarke' = 'Ft. Clarke';
'GHS' = 'Gainesville';
'Glenn Springs' = 'Glen Springs';
'GlennSprings' = 'Glen Springs';
'HiddenOak' = 'Hidden Oak';
'High Springs' = 'High Spr. Comm.';
'High Springs Community' = 'High Spr. Comm.';
'HighSprings' = 'High Spr. Comm.';
'JJ Finley' = 'Finley';
'LakeForest' = 'Lake Forest';
'LittleWood' = 'Littlewood';
'Mabane' = 'Mebane';
'Metcalf' = 'Metcalfe';
'Oakview' = 'Oak View';
'OakView' = 'Oak View';
'SantaFe' = 'Santa Fe';
'WestWood' = 'Westwood'
")
# GET ID FOR EVERY SCHOOL IN CL
cl <- join(x = cl,
y= cf,
type = "left",
by = "school",
match = "first")
# MERGE CFRR TO IR
#cf$school_bad <- NULL
ir <- join(x = ir,
y = cf,
by = "id",
type = "left",
match = "first")
# CONVERT ir$cfrr to percentage
ir$cfrr <- ir$cfrr*100
# CLEAN UP
cf$school_bad <- NULL
head(cl)
ir$gradeprek <- NA
unique(sort(cl$Grade))
for (i in unique(sort(cl$Grade))){
ir[,i] <- NA
}
head(ir)
library(plyr)
ir <- read.csv("ir.csv")
# READ CFRR
cf <- read.csv("cfrr.csv")
cf$school <- as.character(gsub("^\\s+|\\s+$", "", cf$school_bad))
# READ CLASS CFRR AND IR DATA
cl <- read.csv("class.csv")
cl$school <- as.character(gsub("^\\s+|\\s+$", "", cl$School))
# FIX UP CL
library(car)
cl$school <- recode(cl$school,
"'Alachua ES' = 'Alachua';
'AQ Jones' = 'A Quinn';
'Archer Elem' = 'Archer';
'Finely' = 'Finley';
'Ft Clarke' = 'Ft. Clarke';
'GHS' = 'Gainesville';
'Glenn Springs' = 'Glen Springs';
'GlennSprings' = 'Glen Springs';
'HiddenOak' = 'Hidden Oak';
'High Springs' = 'High Spr. Comm.';
'High Springs Community' = 'High Spr. Comm.';
'HighSprings' = 'High Spr. Comm.';
'JJ Finley' = 'Finley';
'LakeForest' = 'Lake Forest';
'LittleWood' = 'Littlewood';
'Mabane' = 'Mebane';
'Metcalf' = 'Metcalfe';
'Oakview' = 'Oak View';
'OakView' = 'Oak View';
'SantaFe' = 'Santa Fe';
'WestWood' = 'Westwood'
")
# GET ID FOR EVERY SCHOOL IN CL
cl <- join(x = cl,
y= cf,
type = "left",
by = "school",
match = "first")
# MERGE CFRR TO IR
#cf$school_bad <- NULL
ir <- join(x = ir,
y = cf,
by = "id",
type = "left",
match = "first")
# CONVERT ir$cfrr to percentage
ir$cfrr <- ir$cfrr*100
# CLEAN UP
cf$school_bad <- NULL
# ADD LOTS OF THINGS TO IR
for (i in unique(sort(cl$Grade))){
ir[,paste0("grade",i)] <- NA
}
head(ir)
head(cl)
for (i in unique(sort(cl$Grade))){
ir[,paste0("cfrr_grade",i)] <- NA
}
#POPULATE GRADE COLUMNS
for (i in unique(sort(cl$grade))){
for (j in unique(ir$id)){
ir[which(ir$id == j),paste0("cfrr_grade", i)] <-
weighted.mean(cl$cfrr[which(cl$id == j & cl$Grade == i)],
cl$Total.Pop[which(cl$id == j & cl$Grade == i)], na.rm=T)
}
}
head(ir)
summary(ir$cfrr_grade10)
for (i in unique(sort(cl$Grade))){
ir[,paste0("cfrr_grade",i)] <- NA
}
head(ir)
weighted.mean(cl$cfrr, cl$Grade)
weighted.mean(cl$cfrr, cl$Total.Pop)
cl$Grade
str(cl$Grade)
str(cl$id)
str(ir$id)
head(cl)
for (i in unique(sort(cl$grade))){
for (j in unique(ir$id)){
ir[which(ir$id == j),paste0("cfrr_grade", i)] <-
mean(cl$cfrr[which(cl$Grade == i & cl$id == j)], na.rm=T)
#       weighted.mean(cl$cfrr[which(cl$id == j & cl$Grade == i)],
#                     cl$Total.Pop[which(cl$id == j & cl$Grade == i)], na.rm=T)
}
}
head(ir)
ir$cfrr_grade3
ir[which(ir$id == 161),paste0("cfrr_grade", 3)]
head(ir)
#Create grade columns
for (i in unique(sort(cl$Grade))){
ir[,paste0("cfrr_grade",i)] <- NA
}
#POPULATE GRADE COLUMNS
for (i in unique(sort(cl$grade))){
for (j in unique(ir$id)){
for (k in inique(sort(ir$year))){
weighted.mean(cl$cfrr[which(cl$id == j & cl$year == k & cl$Grade == i)],
cl$Total.Pop[which(cl$id == j & cl$year == k & cl$Grade == i)], na.rm=T)
}
}
}
#Create grade columns
for (i in unique(sort(cl$Grade))){
ir[,paste0("cfrr_grade",i)] <- NA
}
#POPULATE GRADE COLUMNS
for (i in unique(sort(cl$grade))){
for (j in unique(ir$id)){
for (k in inique(sort(ir$year))){
ir[which(ir$year == k & ir$id == j), paste0("cfrr_grade", i)] <-
weighted.mean(cl$cfrr[which(cl$id == j & cl$year == k & cl$Grade == i)],
cl$Total.Pop[which(cl$id == j & cl$year == k & cl$Grade == i)], na.rm=T)
}
}
}
#POPULATE GRADE COLUMNS
for (i in unique(sort(cl$grade))){
for (j in unique(ir$id)){
for (k in inique(sort(ir$year))){
ir[which(ir$year == k & ir$id == j), paste0("cfrr_grade", i)] <-
mean(cl$cfrr[which(cl$id == j & cl$year == k & cl$Grade == i)], na.rm=T)
}
}
}
head(ir)
ir$cfrr_grade1
ir$year
ir$id
str(cl$year)
str(ir$year)
str(cl$id)
ir[which(ir$year == 2006 & ir$id == 161), paste0("cfrr_grade", 3)]
mean(cl$cfrr)
mean(cl$cfrr[which(cl$id == 161 & cl$year == 2011 & cl$Grade == 3)])
mean(cl$cfrr[which(cl$id == 161 & cl$year == 2011 & cl$Grade == 4)])
mean(cl$cfrr[which(cl$id == 161 & cl$year == 2011 & cl$Grade == 5)])
#Create grade columns
for (i in unique(sort(cl$Grade))){
ir[,paste0("cfrr_grade",i)] <- NA
}
#POPULATE GRADE COLUMNS
for (i in unique(sort(cl$grade))){
for (j in unique(ir$id)){
for (k in inique(sort(ir$year))){
ir[which(ir$year == k & ir$id == j), paste0("cfrr_grade", i)] <-
mean(cl$cfrr[which(cl$id == j & cl$year == k & cl$Grade == i)])
}
}
}
View(ir)
unique(sort(cl$grade))
unique(sort(cl$grade))
unique(sort(cl$Grade))
#Create grade columns
for (i in unique(sort(cl$Grade))){
ir[,paste0("cfrr_grade",i)] <- NA
}
#POPULATE GRADE COLUMNS
for (i in unique(sort(cl$Grade))){
for (j in unique(ir$id)){
for (k in inique(sort(ir$year))){
ir[which(ir$year == k & ir$id == j), paste0("cfrr_grade", i)] <-
mean(cl$cfrr[which(cl$id == j & cl$year == k & cl$Grade == i)])
}
}
}
for (i in unique(sort(cl$Grade))){
for (j in unique(ir$id)){
for (k in unique(sort(ir$year))){
ir[which(ir$year == k & ir$id == j), paste0("cfrr_grade", i)] <-
mean(cl$cfrr[which(cl$id == j & cl$year == k & cl$Grade == i)])
}
}
}
head(ir)
ir$grade2
ir$cfrr_grade2
library(plyr)
ir <- read.csv("ir.csv")
# READ CFRR
cf <- read.csv("cfrr.csv")
cf$school <- as.character(gsub("^\\s+|\\s+$", "", cf$school_bad))
# READ CLASS CFRR AND IR DATA
cl <- read.csv("class.csv")
cl$school <- as.character(gsub("^\\s+|\\s+$", "", cl$School))
# FIX UP CL
library(car)
cl$school <- recode(cl$school,
"'Alachua ES' = 'Alachua';
'AQ Jones' = 'A Quinn';
'Archer Elem' = 'Archer';
'Finely' = 'Finley';
'Ft Clarke' = 'Ft. Clarke';
'GHS' = 'Gainesville';
'Glenn Springs' = 'Glen Springs';
'GlennSprings' = 'Glen Springs';
'HiddenOak' = 'Hidden Oak';
'High Springs' = 'High Spr. Comm.';
'High Springs Community' = 'High Spr. Comm.';
'HighSprings' = 'High Spr. Comm.';
'JJ Finley' = 'Finley';
'LakeForest' = 'Lake Forest';
'LittleWood' = 'Littlewood';
'Mabane' = 'Mebane';
'Metcalf' = 'Metcalfe';
'Oakview' = 'Oak View';
'OakView' = 'Oak View';
'SantaFe' = 'Santa Fe';
'WestWood' = 'Westwood'
")
# GET ID FOR EVERY SCHOOL IN CL
cl <- join(x = cl,
y= cf,
type = "left",
by = "school",
match = "first")
# MERGE CFRR TO IR
#cf$school_bad <- NULL
ir <- join(x = ir,
y = cf,
by = "id",
type = "left",
match = "first")
# CONVERT ir$cfrr to percentage
ir$cfrr <- ir$cfrr*100
# CLEAN UP
cf$school_bad <- NULL
# ADD LOTS OF THINGS TO IR
#Create grade columns
for (i in unique(sort(cl$Grade))){
ir[,paste0("cfrr_grade",i)] <- NA
}
#POPULATE GRADE COLUMNS
for (i in unique(sort(cl$Grade))){
for (j in unique(ir$id)){
for (k in unique(sort(ir$year))){
ir[which(ir$year == k & ir$id == j), paste0("cfrr_grade", i)] <-
weighted.mean(cl$cfrr[which(cl$id == j & cl$year == k & cl$Grade == i)],
cl$Total.Pop[which(cl$id == j & cl$year == k & cl$Grade == i)])
}
}
}
head(ir)
View(ir)
