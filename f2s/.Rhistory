setwd("C:/Users/BrewJR/Documents/farm2school")
source("farmers.R")
setwd("C:/Users/BrewJR/ShinyApps/f2s")
# setwd("C:/Users/BrewJR/Documents/ShinyApps/f2s")
setwd("C:/Users/BrewJR/Documents/ShinyApps/f2s")
source("farmers.R")
library(maps)
Sys.Date()
head(farm)
##########
# READ IN GOOGLE SPREADSHEET
##########
myLink <- "https://docs.google.com/spreadsheet/pub?key=0AsUfdoufBWMJdFV6a0p0NjdDRzJWQzA3WDFzRWxzQ3c&output=csv"
options(RCurlOptions = list(cainfo = system.file("CurlSSL", "cacert.pem", package = "RCurl")))
myCsv <- getURL(myLink)
farm <- read.csv(textConnection(myCsv), skip=0)
rm(myCsv, myLink)
names(farm)
timestamp <- farm$Timestamp
timestamp[1]
timestamp[3]
substr(1, 10, timestamp)
substr(1, 10, as.character(timestamp))
timestamp
as.character(timestamp)
timestamp <- substr(as.character(timestamp), 1, 10)
timestamp
timestamp <- farm$Timestamp
timestamp <- strsplit(timestamp," ")[[1]][1]
timestamp <- as.character(farm$Timestamp)
timestamp <- strsplit(timestamp," ")[[1]][1]
timestamp
timestamp <- as.Date(timestamp, format="%m/%d/%Y")
timestamp
library(RCurl)
library(maps)
##########
# SET WD
##########
# setwd("C:/Users/BrewJR/Documents/ShinyApps/f2s")
##########
# READ IN GOOGLE SPREADSHEET
##########
myLink <- "https://docs.google.com/spreadsheet/pub?key=0AsUfdoufBWMJdFV6a0p0NjdDRzJWQzA3WDFzRWxzQ3c&output=csv"
options(RCurlOptions = list(cainfo = system.file("CurlSSL", "cacert.pem", package = "RCurl")))
myCsv <- getURL(myLink)
farm <- read.csv(textConnection(myCsv), skip=0)
rm(myCsv, myLink)
# DEAL WITH TIMESTAMP ISSUES
timestamp <- as.character(farm$Timestamp)
timestamp <- strsplit(timestamp," ")[[1]][1]
timestamp <- as.Date(timestamp, format="%m/%d/%Y")
###########
# READ IN THE NUMBER OF PREVIOUS GEOCODING
###########
number <- read.csv("number.csv")
number <- number$x
##########
# SUBSET TO ONLY INCLUDE COLUMNS FOR FINAL PRESENTATION
##########
farm <- farm[,c("Farm.name.", "Farmer.name.", "Farm.Mailing.Address.", "Zip.code.",
"Business.Location.County.", "What.are.you.currently.growing.",
"Would.you.be.willing.to.expand.production.of.a.certain.crop.if.the.market.were.available.",
"DO.you.have.a.farm.food.safety.plan.",
"Have.you.ever.received.a.third.party.audit.",
"If.no..would.it.be.helpful.to.have.a.food.safety.training.in.this.county..",
"Do.you.currently.do.any.processing.or.packaging.",
"If.yes..what.type..",
"Do.you.have.an.inspected.audited.facility.for.processing.packing.",
"Would.you.be.willing.to.collaborate.with.a.co.op.to.improve.capacity.for.processing.or.packing.",
"Have.you.been.approached.in.the.past.to.provide.produce.to.schools.or.have.you.ever.tried.to.sell.to.schools.",
"What.is.your.farm.s.total.harvestable.acreage.",
"Do.you.deliver.your.product.to.customers.",
"If.no..how.do.you.handle.delivery.",
"What.are.your.current.sales.distribution.process.",
"What.counties.do.you.currently.serve.",
"NOTES")]
##########
# READ IN EXAMPLE OF FINAL PROJECT
##########
july <- read.csv("report_july.csv", skip=1)
###########
# ASSIGN NAMES OF JULY TO NAMES OF FARM
###########
names(farm) <- names(july)
rm(july)
##############
# ADD BACK IN TIMESTAMP
##############
farm$timestamp <- timestamp
View(farm)
timestamp <- as.character(farm$Timestamp)
timestamp
##########
# READ IN GOOGLE SPREADSHEET
##########
myLink <- "https://docs.google.com/spreadsheet/pub?key=0AsUfdoufBWMJdFV6a0p0NjdDRzJWQzA3WDFzRWxzQ3c&output=csv"
options(RCurlOptions = list(cainfo = system.file("CurlSSL", "cacert.pem", package = "RCurl")))
myCsv <- getURL(myLink)
farm <- read.csv(textConnection(myCsv), skip=0)
rm(myCsv, myLink)
# DEAL WITH TIMESTAMP ISSUES
timestamp <- as.character(farm$Timestamp)
strsplit(timestamp," ")[[1]]
strsplit(timestamp," ")[1]
strsplit(timestamp," ")[[1]][1]
timestamp <- as.character(farm$Timestamp)
timestamp <- gsub('([A-z]+) .*', '\\1', timestamp)
timestamp
timestamp <- as.character(farm$Timestamp)
timestamp <- gsub(' [A-z ]*', '' , timestamp)
timestamp
timestamp <- as.character(farm$Timestamp)
timestamp <- sub(" .*", "", timestamp)
timestamp
timestamp <- as.Date(timestamp, format="%m/%d/%Y")
timestamp
library(RCurl)
library(maps)
##########
# SET WD
##########
# setwd("C:/Users/BrewJR/Documents/ShinyApps/f2s")
##########
# READ IN GOOGLE SPREADSHEET
##########
myLink <- "https://docs.google.com/spreadsheet/pub?key=0AsUfdoufBWMJdFV6a0p0NjdDRzJWQzA3WDFzRWxzQ3c&output=csv"
options(RCurlOptions = list(cainfo = system.file("CurlSSL", "cacert.pem", package = "RCurl")))
myCsv <- getURL(myLink)
farm <- read.csv(textConnection(myCsv), skip=0)
rm(myCsv, myLink)
# DEAL WITH TIMESTAMP ISSUES
timestamp <- as.character(farm$Timestamp)
timestamp <- sub(" .*", "", timestamp)
timestamp <- as.Date(timestamp, format="%m/%d/%Y")
###########
# READ IN THE NUMBER OF PREVIOUS GEOCODING
###########
number <- read.csv("number.csv")
number <- number$x
##########
# SUBSET TO ONLY INCLUDE COLUMNS FOR FINAL PRESENTATION
##########
farm <- farm[,c("Farm.name.", "Farmer.name.", "Farm.Mailing.Address.", "Zip.code.",
"Business.Location.County.", "What.are.you.currently.growing.",
"Would.you.be.willing.to.expand.production.of.a.certain.crop.if.the.market.were.available.",
"DO.you.have.a.farm.food.safety.plan.",
"Have.you.ever.received.a.third.party.audit.",
"If.no..would.it.be.helpful.to.have.a.food.safety.training.in.this.county..",
"Do.you.currently.do.any.processing.or.packaging.",
"If.yes..what.type..",
"Do.you.have.an.inspected.audited.facility.for.processing.packing.",
"Would.you.be.willing.to.collaborate.with.a.co.op.to.improve.capacity.for.processing.or.packing.",
"Have.you.been.approached.in.the.past.to.provide.produce.to.schools.or.have.you.ever.tried.to.sell.to.schools.",
"What.is.your.farm.s.total.harvestable.acreage.",
"Do.you.deliver.your.product.to.customers.",
"If.no..how.do.you.handle.delivery.",
"What.are.your.current.sales.distribution.process.",
"What.counties.do.you.currently.serve.",
"NOTES")]
##########
# READ IN EXAMPLE OF FINAL PROJECT
##########
july <- read.csv("report_july.csv", skip=1)
###########
# ASSIGN NAMES OF JULY TO NAMES OF FARM
###########
names(farm) <- names(july)
rm(july)
##############
# ADD BACK IN TIMESTAMP
##############
farm$timestamp <- timestamp
###########
# GEOCODE FARMS
###########
library(RCurl)
library(RJSONIO)
library(plyr)
url <- function(address, return.call = "json", sensor = "false") {
root <- "http://maps.google.com/maps/api/geocode/"
u <- paste(root, return.call, "?address=", address, "&sensor=", sensor, sep = "")
return(URLencode(u))
}
geoCode <- function(address,verbose=FALSE) {
if(verbose) cat(address,"\n")
u <- url(address)
doc <- getURL(u)
x <- fromJSON(doc,simplify = FALSE)
if(x$status=="OK") {
lat <- x$results[[1]]$geometry$location$lat
lng <- x$results[[1]]$geometry$location$lng
location_type <- x$results[[1]]$geometry$location_type
formatted_address <- x$results[[1]]$formatted_address
return(c(lat, lng, location_type, formatted_address))
} else {
return(c(NA,NA,NA, NA))
}
}
# Use plyr to getgeocoding for a vector
addressify <- function(x){
address <- paste(as.character(gsub(" FL | fl | Fl |FL,| fl,| Fl,|,,", "", x)), "Florida")
address[which(address == " Florida")] <- ""
return(address)
}
farm$Farm.Mailing.Address. <- addressify(farm$Farm.Mailing.Address)
address <- farm$Farm.Mailing.Address.
address[which(address == "")] <- paste0(farm$Farm.name[which(address == "")], ", Florida")
###### GEOCODE NEW ROWS
if(nrow(farm) > number){
#only geocode new rows
locations <- ldply(address[if(nrow(farm) == (number+1)){(number+1)}else{(number+1):nrow(farm)}], function(x) geoCode(x))
names(locations) <- c("lat","lon","location_type", "forAddress")
############
# MAKE NA THE "FLORIDA" ONES
############
locations$lat[which(locations$lat == 27.6648274 & locations$lon == -81.5157535)] <- NA
locations$lon[which(is.na(locations$lat))] <- NA
############
# CREATE GEOCODED DATAFRAME OF ADDRESSES AND POINTS
############
new.gc <- data.frame(cbind(address[if(nrow(farm) == (number+1)){(number+1)}else{(number+1):nrow(farm)}], locations))
names(new.gc)[1] <- "Farm.Mailing.Address."
############
# READ IN OLD GC
############
gc <- read.csv("gc.csv")
gc$X <- NULL
############
# RBIND OLD GC WITH NEW GC
############
y <- as.data.frame(rbind(gc, new.gc))
gc <- y
rm(new.gc)
#############
# WRITE THE GC FOR ALL TIMES
#############
write.csv(gc, "gc.csv")
############
# WRITE A CSV TO SAY HOW MANY ADDRESSES WERE ALREADY GEOCODED
############
write.csv(nrow(gc), "number.csv")
}else{
############
# READ IN OLD GC
############
gc <- read.csv("gc.csv")
gc$X <- NULL
}
############
# MERGE FARM AND GC
############
library(plyr)
farm <- join(x = farm,
y = gc,
by = "Farm.Mailing.Address.",
type = "left",
match = "first")
############
# monthify function
############
Monthify <- function(x){
format(Sys.Date())
}
farm$timestamp
Monthify <- function(x){
format(x, format = "%B")
}
Monthify(timestamp)
farm$month <- Monthify(timestamp)
farm$month
shiny::runApp()
shiny::runApp()
names(farm)
shiny::runApp()
map("county", "fl")
shiny::runApp()
map("county", "fl", fill=TRUE, col="grey", border=FALSE)
map("county", "fl", fill=TRUE, col="grey", border="grey")
map("county", "fl", fill=TRUE, col="grey", border="darkgrey")
map("county", "fl", fill=TRUE, col="grey", border="white")
points(mydata()$lon, mydata()$lat,
col=adjustcolor("darkred", alpha.f=0.6),
pch=16)
shiny::runApp()
names(farm)
shiny::runApp()
library(RColorBrewer)
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
mycols <- adjust.color(colorRampPalette(brewer.pal(8, "Dark2"))(nrow(mydata())), alpha.f=0.8)
adjust.color()
adjustcolor
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
names(farm)
shiny::runApp()
shiny::runApp()
shiny::runApp()
names(farm)
farm$What.is.your.farm.s.total.harvestable.acreage
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
library(shinyapps)
shinyapps::setAccountInfo(
name="joebrew",
token="C4D0E22C484D74139A50EDE2BA1887F4",
secret="zbbeauXf53w0Qnpxcx1RREIdIUJAaRaVjZLcN/Id")
setwd("c:/users/brewjr/documents/ShinyApps/f2s")
library(shiny)
runApp()
library(shiny)
deployApp()
setwd("c:/users/brewjr/documents/ShinyApps/f2s")
deployApp()
deployApp("f2s")
setwd("c:/users/brewjr/documents/ShinyApps/")
deployApp("f2s")
