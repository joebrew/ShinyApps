{
    "contents" : "#######################\n# ATTACH LIBRARIES\n#######################\n\nlibrary(RCurl)\nlibrary(RColorBrewer)\nsuppressPackageStartupMessages(library(googleVis))\nlibrary(reshape)\nlibrary(reldist)\n#######################\n# READ IN IMMUNIZATION HISTORY FROM GOOGLE\n#######################\n# \n# myLink <- \"https://docs.google.com/spreadsheets/d/1rJrZwc9KmQsa2a7bOAX4wvPLc2p4lEtiuvxyufmE070/export?&format=csv\"\n# options(RCurlOptions = list(cainfo = system.file(\"CurlSSL\", \"cacert.pem\", package = \"RCurl\")))\n# myCsv <- getURL(myLink)\n# \n# ir <- read.csv(textConnection(myCsv), skip=0)\n# rm(myCsv, myLink)\n# \n# ir$team2014 <- factor(ir$team2014)\n\n# READ LOCALLY  - CHANGE LATER\n#setwd(\"C:/Users/BrewJR/Documents/ShinyApps/controlflu\")\nir <- read.csv(\"ir.csv\")\ncf <- read.csv(\"cfrr.csv\")\n\n\n#make team factor\nir$team2014 <- factor(ir$team2014)\n\n#Make grade columns factors\nfor (i in 0:12){\n  for (j in c(\"cfrr\", \"immRate\")){\n    ir[,paste0(j,\"_grade\",i)] <- \n      factor(ir[,paste0(j,\"_grade\",i)])\n  }\n}\n\n# fix the -1s\nir$cfrr_grade.1 <- factor(ir$cfrr_grade.1)\nir$immRate_grade.1 <- factor(ir$immRate_grade.1)\n\n\n#######################\n# FUNCTION FOR PLOTTING BY GRADE\n#######################\n\n\n# \n# \n# plot(x = 2006:2013, \n#      y = seq(0,100, length=length(2006:2013)),\n#      type = \"n\",\n#      xlab = \"Year\",\n#      ylab = \"Immunization rate\",\n#      ylim=c(0,100), main=\"All years\")\n# \n# x <- ir[which(ir$team2014 == 4),]\n# \n# ids <- unique(sort(x$id))\n# grades <- -1:12\n# \n# for (i in ids){\n#   for (j in grades){\n#     \n#     lines(x[which(x$id == ids[i]), paste0(\"year\")],\n#           x[which(x$id == ids[i]), paste0(\"cfrr_grade\", j)])\n#     \n#     \n#   }\n# }\n# \n# lines(x[which(x$id == ids[2]), paste0(\"year\")],\n#       x[which(x$id == ids[2]), paste0(\"cfrr_grade\", 2)])\n# \n# \n# GradeFun <- function(team=1, data=ir){\n#   plot(x = 2006:2013, \n#        y = seq(0,100, length=length(2006:2013)),\n#        type = \"n\",\n#        xlab = \"Year\",\n#        ylab = \"Immunization rate\",\n#        ylim=c(0,100), main=\"All years\")\n#   \n#   # PLOT LINES\n#   \n#   x <- data[which(data$team2014 == team),]\n#   \n#   for (i in -1:12){\n#     \n#     xx <- x$year[which(x[,paste0(\"immRate_grade\", i)])]\n#     yy <- x$immRate[, paste0(\"immRate_grade\", i)]\n#     \n#   }\n#   \n#   for (i in 1:length(schools)){\n#     \n#     xx <- x$year[which(x$school == schools[i] )]\n#     yy <- x$immRate[which(x$school == schools[i] )]\n#     #x$color[which(x$school == schools[i])] <- mycols[i]\n#     \n#     cc <- x$color[which(x$school == schools[i])][1]\n#     lines(xx, yy, col=cc, lwd=1)\n#     points(xx, yy, col=cc, pch=16, cex=1)    \n#   }  \n#     \n#   abline(v=2006:2013, col=adjustcolor(\"black\", alpha.f=0.1))\n#   abline(h=seq(0,100,20), col=adjustcolor(\"black\", alpha.f=0.1))    \n#   \n# }\n# \n# plot(ir$cfrr_grade1, ir$immRate_grade1)\n\n#######################\n# FUNCTION FOR PLOTTING EACH TEAM'S TRAJECTORIES\n#######################\nTeamFun <- function(team, data, cf=FALSE, bar=FALSE){\n  \n  x <- data[which(as.numeric(data[,\"team2014\"]) == as.numeric(team)),]\n  \n  schools <- unique(x$school)   #unique(sort(x$school))\n  mycols <- colorRampPalette(brewer.pal(8, \"Dark2\"))(length(schools)) \n  mycols <- adjustcolor(mycols, alpha.f=0.4)\n  \n  # ASSIGN COLOR\n  x$color <- \"grey\"\n  for (i in 1:length(schools)){    \n    x$color[which(x$school == schools[i])] <- mycols[i]\n  }  \n  \n  \n  if(bar==FALSE & cf==FALSE){\n    plot(x = 2006:2013, \n         y = seq(0,100, length=length(2006:2013)),\n         type = \"n\",\n         xlab = \"Year\",\n         ylab = \"Immunization rate\",\n         ylim=c(0,100), main=\"All years\")\n    \n    # PLOT LINES\n    for (i in 1:length(schools)){\n\n      xx <- x$year[which(x$school == schools[i] )]\n      yy <- x$immRate[which(x$school == schools[i] )]\n      #x$color[which(x$school == schools[i])] <- mycols[i]\n      \n      cc <- x$color[which(x$school == schools[i])][1]\n      lines(xx, yy, col=cc, lwd=1)\n      points(xx, yy, col=cc, pch=16, cex=1)    \n    }  \n    \n    legend(x=\"topleft\",\n           lty=1,\n           lwd=1,\n           pch=16,\n           col=mycols,\n           legend=schools,\n           cex=0.7,\n           bty=\"n\",\n           ncol=3)\n    \n    abline(v=2006:2013, col=adjustcolor(\"black\", alpha.f=0.1))\n    abline(h=seq(0,100,20), col=adjustcolor(\"black\", alpha.f=0.1))  \n  }else if(cf==TRUE & bar==FALSE){\n    \n    x <- x[which(x$year == 2013),]\n    \n    plot(x$cfrr, x$immRate, col=x$color, pch=16,\n         xlim=c(0,100), ylim=c(0,100),\n         cex=3,\n         xlab=\"2013 consent form return rate\",\n         ylab=\"2013 immunization rate\")\n    \n    text(jitter(x$cfrr, factor=5), jitter(x$immRate, factor=5), col=adjustcolor(\"black\", alpha.f=0.6),\n         labels=x$school,\n         cex=0.6)\n    abline(v=seq(0,100,20), col=adjustcolor(\"black\", alpha.f=0.1))\n    abline(h=seq(0,100,20), col=adjustcolor(\"black\", alpha.f=0.1))  \n         \n    \n  }else if(cf==TRUE & bar == TRUE){ \n    x <- x[which(x$year == 2013),]\n    x <- x[order(x$cfrr),]\n    \n    bp <- barplot(x$cfrr, col=x$color, names.arg=x$school, cex.names=0.7,\n                  border=FALSE, las=3, main=\"2013 Consent form return rate\",\n                  ylab=\"Consent form return rate\")\n    \n    text(x=bp[,1], y = x$cfrr, pos=1, labels=round(x$cfrr, digits=2),\n         col=adjustcolor(\"black\", alpha.f=0.5))\n  }else{\n    # BARPLOT\n    \n    x <- x[which(x$year == 2013),]\n    x <- x[order(x$immRate),]\n    \n    bp <- barplot(x$immRate, col=x$color, names.arg=x$school, cex.names=0.7,\n            border=FALSE, las=3, main=\"Last year\",\n            ylab=\"Immunization rate\")\n    \n    text(x=bp[,1], y = x$immRate, pos=1, labels=round(x$immRate, digits=2),\n         col=adjustcolor(\"black\", alpha.f=0.5))\n\n  } \n\n}\n\n#TeamFun(team = 4, data = ir, bar = FALSE)\n#######################\n# PLOT\n# #######################\n# M <- gvisMotionChart(data = ir, \n#                      idvar = \"school\",\n#                      timevar = \"year\")\n# , \n#                      idvar = \"school\", \n#                      timevar = \"year\",\n#                      #xvar = \"year\",\n#                      #yvar = \"immRate\",\n#                      colorvar = \"team2014\",\n#                      sizevar = \"totMem\")\n# plot(M)\n# \n# M <- gvisMotionChart(data = ir, idvar=\"school\", timevar=\"year\")\n# \n# \n# plot(M)\n\n#######################\n#\n#######################\n\n\n#######################\n#\n#######################",
    "created" : 1409142370421.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1228428296",
    "id" : "1EC11954",
    "lastKnownWriteTime" : 1409012783,
    "path" : "~/ShinyApps/controlflu/helper.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}