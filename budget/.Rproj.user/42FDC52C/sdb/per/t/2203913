{
    "contents" : "library(shiny)\n\n\n\n#########################\n# SOURCE IN HELPER FUNCTION\n##############\nsource(\"BudgetFun.R\")\n\n\n\n\nshinyServer(function(input, output) {\n  \n  output$a <- renderPlot({\n    x <- BudgetFunList(tot = as.numeric(input$b4),\n                       n.messages = input$b5, \n                       cost.eip.mail = input$b10,\n                       cost.post.eip.mail = input$b11,\n                       phone.contact = input$b13,\n                       n.interviews = as.numeric(input$b14),\n                       phone.cost = input$b15,\n                       effect.without.eip = input$b18,\n                       effect.with.eip.1 = input$b19,\n                       effect.with.eip.2 = input$b20)\n    \n    temp <- colorRampPalette(c(\"darkred\", \"darkgreen\"))(200)\n    \n    color <- adjustcolor(temp[ceiling(x$b38)], alpha.f=0.2)\n    my_color <- ifelse(x$b38 < 200,\n                       color,\n                       \"darkgreen\")\n    \n    par(mfrow=c(2,2))\n    par(mar=c(5,7,1,1))\n    bp <- barplot(c(x$b31, x$b32, x$b33),\n                  names.arg=c(\"EIP mail\",\n                              \"Phone surveys\",\n                              \"Analysis and\\nroboscreen\"),\n                  las=1,\n                  horiz=TRUE,\n                  xlab=\"Dollars\",\n                  border=FALSE,\n                  col=adjustcolor(\"grey\", alpha.f=0.2))\n    title(main=\"Cost breakdown\", \n          cex.main=1, \n          col=adjustcolor(\"black\", alpha.f=0.5))\n    \n    text(x=0, y=bp[,1],  pos=4,\n         col=adjustcolor(\"black\", alpha.f=0.7),\n         labels=paste(\"$\", round(c(x$b31, x$b32, x$b33), digits=2)),\n         cex=1)\n    \n    par(mar=c(5,3,1,1))\n    \n    bp <- barplot(x$b38,\n                  col = my_color,\n                  border=FALSE,\n                  ylim=c(0, x$b38 + 5))\n    title(main=\"% increase in persuaded voters\", \n          cex.main=1, \n          col=adjustcolor(\"black\", alpha.f=0.5))\n    \n    \n    text(x=bp[,1], y=ifelse(x$b38 > 0, 10, -10),\n         col=adjustcolor(\"black\", alpha.f=0.5),\n         labels=paste(round(x$b38, digits=2), \"%\"),\n         cex=1.5)\n    #box(\"plot\")\n    \n    abline(h=100, col=adjustcolor(\"darkgreen\", alpha.f=0.4), lwd=2)\n    abline(h=0, col=adjustcolor(\"darkred\", alpha.f=0.4), lwd=2)\n    \n    bp <- barplot(x$b34,\n                  col = adjustcolor(\"grey\", alpha.f=0.2),\n                  border=FALSE,\n                  ylim=c(0, x$b34 + 5)) \n    \n    title(main=\"Total budget after EIP\",\n          cex.main=1, \n          col=adjustcolor(\"black\", alpha.f=0.5))\n    \n    \n    text(x=bp[,1], y=0.1*x$b34,\n         col=adjustcolor(\"black\", alpha.f=0.5),\n         labels=paste(\"$\", round(x$b34, digits=2)),\n         cex=1.5)\n    \n    bp <- barplot(x$b36,\n                  col = adjustcolor(\"grey\", alpha.f=0.2),\n                  border=FALSE)\n    title(main=\"Persuaded voters\", \n          cex.main=1, \n          col=adjustcolor(\"black\", alpha.f=0.5))\n    \n    \n    text(x=bp[,1], y=0.1*x$b36,\n         col=adjustcolor(\"black\", alpha.f=0.5),\n         labels=paste(round(x$b36, digits=0)),\n         cex=1.5)\n  })\n  \n  output$b <- renderTable({\n    BudgetFun(tot = as.numeric(input$b4),\n              n.messages = input$b5, \n              cost.eip.mail = input$b10,\n              cost.post.eip.mail = input$b11,\n              phone.contact = input$b13,\n              n.interviews = as.numeric(input$b14),\n              phone.cost = input$b15,\n              effect.without.eip = input$b18,\n              effect.with.eip.1 = input$b19,\n              effect.with.eip.2 = input$b20)\n  },include.rownames=FALSE)\n  \n  \n  # tot\n  # n.messages\n  # cost.eip.mail\n  # cost.post.eip.mail\n  # phone.contact\n  # n.interviews\n  # phone.cost\n  # effect.without.eip\n  # effect.with.eip.1\n  # effect.with.eip.2\n  \n#   \n#   output$distPlot <- renderPlot({\n#     \n#     barplot((1:10)^3)\n#   })\n#   \n#   # NUMBER OF MAIL TARGETS PER CONDITION\n#   output$n.targets <- renderText({\n#     as.numeric(input$n.interviews) / input$phone.contact\n#   })\n#   \n#   #TOTAL BUDGET \n#   output$total.budget <- renderText({\n#     paste0(\"$\", as.numeric(input$tot))\n#   })\n#   \n#   ################################## BEGIN WITHOUT EIP\n#   \n#   # WITHOUT EIP - NUMBER OF TARGETS AFFORED\n#   output$n.targets.afforded <- renderText({\n#     as.numeric(input$tot) / as.numeric(input$cost.post.eip.mail)\n#   })\n#   \n#   # WITHOUT EIP - PERSUADED VOTERS\n#   output$persuaded.voters <- renderText({\n#     \n#     (as.numeric(input$tot) / as.numeric(input$cost.post.eip.mail)) * # B26\n#       (input$effect.without.eip/100)\n#   })\n#   ################################### END WITHOUT EIP\n#   \n#   ################################## BEGIN WITH EIP\n# \n#   # WITH EIP - TOTAL COST OF EIP MAIL\n#   output$cost.eip.mail <- renderText({\n#    (as.numeric(input$n.interviews)/as.numeric(input$phone.contact)) *   # b14 / b13 = b16\n#      as.numeric(input$n.messages)\n#   })\n#   \n#   # WITH EIP - TOTAL COST OF PHONE SURVEYS\n#   output$cost.eip.mail <- renderText({\n#     (as.numeric(input$n.interviews)/as.numeric(input$phone.contact)) *   # b14 / b13 = b16\n#       (as.numeric(input$n.messages) + 1) * #b5 +1\n#       (as.numeric(input$phone.contact)/100)  * # b13\n#       (as.numeric(input$phone.cost))  # b15\n#   })\n#   \n#   # WITH EIP - TOTAL COST OF ANALYSIS AND ROBOSCREEN\n#   output$cost.analysis <- renderText({\n#     15250\n#   })\n#   \n#   # WITH EIP - TOTAL BUDGET AFTER EIP\n#   output$budget.after.eip <- renderText({\n#     \n#     (as.numeric(input$tot)) - #b30 \n#       sum(c( \n#         #b31\n#         (as.numeric(input$n.interviews)/as.numeric(input$phone.contact)) *   # b14 / b13 = b16\n#           as.numeric(input$n.messages), \n#         #b32 \n#         (as.numeric(input$n.interviews)/as.numeric(input$phone.contact)) *   # b14 / b13 = b16\n#           (as.numeric(input$n.messages) + 1) * #b5 +1\n#           (as.numeric(input$phone.contact)/100)  * # b13\n#           (as.numeric(input$phone.cost))  # b15\n#         , \n#         #b33\n#         15250\n#             )) \n#   })\n#   \n#   # WITH EIP - NUMBER OF TARGETS AFFORDED POST-EIP\n#   output$n.targes.post.eip <- renderText({\n#     # b34 - b11\n#     \n#     # b34\n#     (    (as.numeric(input$tot)) - #b30 \n#            sum(c( \n#              #b31\n#              (as.numeric(input$n.interviews)/as.numeric(input$phone.contact)) *   # b14 / b13 = b16\n#                as.numeric(input$n.messages), \n#              #b32 \n#              (as.numeric(input$n.interviews)/as.numeric(input$phone.contact)) *   # b14 / b13 = b16\n#                (as.numeric(input$n.messages) + 1) * #b5 +1\n#                (as.numeric(input$phone.contact)/100)  * # b13\n#                (as.numeric(input$phone.cost))  # b15\n#              , \n#              #b33\n#              15250\n#            )) ) -\n#       #b11\n#       (input$cost.post.eip.mail)\n#  \n#     \n#   })\n# \n#   \n#   # tot\n#   # n.messages\n#   # cost.eip.mail\n#   # cost.post.eip.mail\n#   # phone.contact\n#   # n.interviews\n#   # phone.cost\n#   # effect.without.eip\n#   # effect.with.eip.1\n#   # effect.with.eip.2\n#   \n#   # WITH EIP - PERSUADED VOTERS\n#   output$persuaded.voters.w <- renderText({\n#     \n#     # if(b5 = 1){\n#     if(input$n.messages == 1){\n#       \n#       # (b35*b19) + (b16+b18)\n#       \n#       #b35\n#       ((\n#         # b34 - b11\n#         \n#         # b34\n#         (    (as.numeric(input$tot)) - #b30 \n#                sum(c( \n#                  #b31\n#                  (as.numeric(input$n.interviews)/as.numeric(input$phone.contact)) *   # b14 / b13 = b16\n#                    as.numeric(input$n.messages), \n#                  #b32 \n#                  (as.numeric(input$n.interviews)/as.numeric(input$phone.contact)) *   # b14 / b13 = b16\n#                    (as.numeric(input$n.messages) + 1) * #b5 +1\n#                    (as.numeric(input$phone.contact)/100)  * # b13\n#                    (as.numeric(input$phone.cost))  # b15\n#                  , \n#                  #b33\n#                  15250\n#                )) ) -\n#           #b11\n#           (input$cost.post.eip.mail)\n#         \n#         )*\n#         #b19\n#         (input$effect.with.eip.1)) +\n#         #b16\n#         (((as.numeric(input$n.interviews)/as.numeric(input$phone.contact)) ) +\n#         #b18\n#         (input$effect.without.eip))\n#       \n#     }else{\n#       #b35\n#       ((    # b34\n#         (    (as.numeric(input$tot)) - #b30 \n#                sum(c( \n#                  #b31\n#                  (as.numeric(input$n.interviews)/as.numeric(input$phone.contact)) *   # b14 / b13 = b16\n#                    as.numeric(input$n.messages), \n#                  #b32 \n#                  (as.numeric(input$n.interviews)/as.numeric(input$phone.contact)) *   # b14 / b13 = b16\n#                    (as.numeric(input$n.messages) + 1) * #b5 +1\n#                    (as.numeric(input$phone.contact)/100)  * # b13\n#                    (as.numeric(input$phone.cost))  # b15\n#                  , \n#                  #b33\n#                  15250\n#                )) ) -\n#           #b11\n#           (input$cost.post.eip.mail)\n#         \n#       ) *\n#         #b20\n#         (input$effect.with.eip.2)) +\n#         #b16\n#         (((as.numeric(input$n.interviews)/as.numeric(input$phone.contact)) )*\n#         #b5\n#         (input$n.messages) *\n#         #b18\n#         (effect.without.eip))\n#       \n#     }\n#   })\n#   \n#   \n#   ################################### END WITH EIP\n#   \n#   # PERCENT INCREASE IN PERSUADED VOTERS\n#   output$p.increase.persuaded.voters <- renderText({\n# \n#     # (b36 - b27) / b27\n#     \n#     #b36\n#     ((    # if(b5 = 1){\n#       if(input$n.messages == 1){\n#         \n#         # (b35*b19) + (b16+b18)\n#         \n#         #b35\n#         ((\n#           # b34 - b11\n#           \n#           # b34\n#           (    (as.numeric(input$tot)) - #b30 \n#                  sum(c( \n#                    #b31\n#                    (as.numeric(input$n.interviews)/as.numeric(input$phone.contact)) *   # b14 / b13 = b16\n#                      as.numeric(input$n.messages), \n#                    #b32 \n#                    (as.numeric(input$n.interviews)/as.numeric(input$phone.contact)) *   # b14 / b13 = b16\n#                      (as.numeric(input$n.messages) + 1) * #b5 +1\n#                      (as.numeric(input$phone.contact)/100)  * # b13\n#                      (as.numeric(input$phone.cost))  # b15\n#                    , \n#                    #b33\n#                    15250\n#                  )) ) -\n#             #b11\n#             (input$cost.post.eip.mail)\n#           \n#         )*\n#           #b19\n#           (input$effect.with.eip.1)) +\n#           #b16\n#           (((as.numeric(input$n.interviews)/as.numeric(input$phone.contact)) ) +\n#              #b18\n#              (input$effect.without.eip))\n#         \n#       }else{\n#         #b35\n#         ((    # b34\n#           (    (as.numeric(input$tot)) - #b30 \n#                  sum(c( \n#                    #b31\n#                    (as.numeric(input$n.interviews)/as.numeric(input$phone.contact)) *   # b14 / b13 = b16\n#                      as.numeric(input$n.messages), \n#                    #b32 \n#                    (as.numeric(input$n.interviews)/as.numeric(input$phone.contact)) *   # b14 / b13 = b16\n#                      (as.numeric(input$n.messages) + 1) * #b5 +1\n#                      (as.numeric(input$phone.contact)/100)  * # b13\n#                      (as.numeric(input$phone.cost))  # b15\n#                    , \n#                    #b33\n#                    15250\n#                  )) ) -\n#             #b11\n#             (input$cost.post.eip.mail)\n#           \n#         ) *\n#           #b20\n#           (input$effect.with.eip.2)) +\n#           #b16\n#           (((as.numeric(input$n.interviews)/as.numeric(input$phone.contact)) )*\n#              #b5\n#              (input$n.messages) *\n#              #b18\n#              (effect.without.eip))\n#         \n#       }) -\n#       #b27\n#       (    (as.numeric(input$tot) / as.numeric(input$cost.post.eip.mail)) * # B26\n#              (input$effect.without.eip/100))) / \n#       #b27\n#       *(    (as.numeric(input$tot) / as.numeric(input$cost.post.eip.mail)) * # B26\n#               (input$effect.without.eip/100))\n#     \n#   })\n#   \n  \n  \n  ######### END\n})\n\n\n\n",
    "created" : 1407946346464.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "248838525",
    "id" : "2203913",
    "lastKnownWriteTime" : 1407967118,
    "path" : "~/ShinyApps/budget/server.R",
    "project_path" : "server.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}